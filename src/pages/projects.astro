---
import MainLayout from '../layouts/MainLayout.astro';

// Example projects - you can add more as you build them
const projects = [
  {
    id: 'shiny-dashboard',
    title: 'Shiny Dashboard',
    description: 'Interactive data visualizations built with R Shiny',
    url: '#', // Replace with actual URL when ready
    status: 'coming-soon', // or 'active'
  },
  {
    id: 'power-bi-reports',
    title: 'Power BI Reports',
    description: 'Business intelligence dashboards and analytics',
    url: '#',
    status: 'coming-soon',
  },
  {
    id: 'tableau-viz',
    title: 'Tableau Visualizations',
    description: 'Data storytelling with Tableau',
    url: '#',
    status: 'coming-soon',
  },
  {
    id: 'ai-chatbot',
    title: 'AI Chatbot',
    description: 'Interactive AI-powered assistant',
    url: '#',
    status: 'coming-soon',
  },
];
---

<MainLayout
  title="Projects - Jason Paladini"
  description="Projects by Jason Paladini"
>
  <div class="max-w-4xl mx-auto px-6 py-12 sm:py-16">
    <!-- Loading state (shown initially while checking auth) -->
    <div id="loading-state" class="flex items-center justify-center py-16">
      <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
    </div>

    <!-- Login gate (shown if not authenticated) -->
    <div id="login-gate" class="hidden">
      <div class="max-w-md mx-auto text-center">
        <svg class="w-16 h-16 mx-auto mb-4 text-gray-400 dark:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z" />
        </svg>
        <h1 class="text-2xl sm:text-3xl font-bold mb-3">Authentication Required</h1>
        <p class="text-gray-600 dark:text-gray-400 mb-6">
          Please sign in to access projects and showcases.
        </p>
        <a
          href="/login"
          class="inline-block py-2 px-6 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-md transition-colors"
        >
          Sign In
        </a>
      </div>
    </div>

    <!-- Projects grid (shown if authenticated) -->
    <div id="projects-content" class="hidden">
      <header class="mb-12">
        <h1 class="text-3xl sm:text-4xl font-bold mb-2">Projects</h1>
        <p class="text-lg text-gray-600 dark:text-gray-400">Explore my work</p>
      </header>

      <!-- 2x2 Project Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        {projects.map((project) => (
          <a
            href={project.status === 'active' ? project.url : '#'}
            class={`group block p-6 bg-white dark:bg-slate-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 transition-all ${
              project.status === 'active'
                ? 'hover:shadow-xl hover:-translate-y-1 cursor-pointer'
                : 'opacity-60 cursor-not-allowed'
            }`}
            aria-disabled={project.status !== 'active'}
          >
            <div class="flex items-start justify-between mb-3">
              <h2 class="text-xl font-bold group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">
                {project.title}
              </h2>
              {project.status === 'coming-soon' && (
                <span class="px-2 py-1 text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded">
                  Coming Soon
                </span>
              )}
            </div>
            <p class="text-gray-600 dark:text-gray-400 text-sm">
              {project.description}
            </p>
          </a>
        ))}
      </div>

      <!-- Empty state if no active projects -->
      {projects.filter(p => p.status === 'active').length === 0 && (
        <div class="mt-12 text-center py-8">
          <p class="text-gray-500 dark:text-gray-400">
            Projects are being prepared. Check back soon!
          </p>
        </div>
      )}
    </div>
  </div>

  <script>
    import { getSession } from '../lib/auth';

    async function checkAuth() {
      const loadingState = document.getElementById('loading-state');
      const loginGate = document.getElementById('login-gate');
      const projectsContent = document.getElementById('projects-content');

      try {
        const session = await getSession();

        if (session) {
          // User is authenticated - show projects
          loadingState?.classList.add('hidden');
          projectsContent?.classList.remove('hidden');
        } else {
          // User is not authenticated - show login gate
          loadingState?.classList.add('hidden');
          loginGate?.classList.remove('hidden');
        }
      } catch (error) {
        console.error('Error checking auth:', error);
        // On error, show login gate
        loadingState?.classList.add('hidden');
        loginGate?.classList.remove('hidden');
      }
    }

    // Check auth on page load
    checkAuth();
  </script>
</MainLayout>
